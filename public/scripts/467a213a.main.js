!function(){window.Frontend=Ember.Application.create()}(),function(){Frontend.AdminController=Ember.ArrayController.extend({schoolNameSearch:"",schoolFound:"",performedSchoolSearch:!1,actions:{filterByName:function(){var a=this.get("schoolNameSearch").toUpperCase();this.set("performedSchoolSearch",!0);var b=this.filterBy("name",a);0!==b.length?this.set("schoolFound",b[0]):this.set("schoolFound","")}}})}(),function(){Frontend.CounterController=Ember.ObjectController.extend({actions:{startOdometer:function(){console.log("starting odometer");var a=document.querySelector(".students-pass-rate");this.odometerFor(a,this.get("pass_rate")),a=document.querySelector(".students-passed"),this.odometerFor(a,this.get("passed")),a=document.querySelector(".students-wrote"),this.odometerFor(a,this.get("wrote"))}},odometerPassedValueChanged:function(){window.$(".students-passed").html(this.get("passed")),window.$(".students-wrote").html(this.get("wrote")),window.$(".students-pass-rate").html(this.get("pass_rate"))}.observes("passed","wrote","pass_rate"),odometerFor:function(a,b){Ember.run(this,function(){new window.Odometer({el:a,value:0}),a.innerHTML=b})}})}(),function(){Frontend.CountryController=Ember.ObjectController.extend({needs:["counter"],counter:Ember.computed.alias("controllers.counter"),showCountry:function(){var a=this;this.store.find("country",1).then(function(b){var c=a.get("counter");c.set("model",a.store.createRecord("counter")),c.set("passed",b.get("passed")),c.set("wrote",b.get("wrote")),c.set("pass_rate",b.get("pass_rate")),c.set("title",b.get("name")),c.send("startOdometer")})}.property("showCountry")})}(),function(){Frontend.IndexController=Ember.ObjectController.extend({})}(),function(){Frontend.NavbarController=Ember.ObjectController.extend({})}(),function(){Frontend.ProvincesController=Ember.ObjectController.extend({needs:"counter",counter:Ember.computed.alias("controllers.counter"),drawAll:function(){var a=this;Ember.$.ajax("/data/sa_provinces.json").then(function(b){Frontend.globalPaths=b,a.get("store").findAll("province").then(function(a){a.forEach(function(a){var b=window.L.geoJson(a.get("dataFromJSON"),{style:a.get("geoJSONStyle"),province:a,onEachFeature:a.get("onEachFeature")});a.set("geo_json",b),b.addTo(Frontend.map),window.province=a})})})}.property("drawAll")})}(),function(){Frontend.Store=DS.Store.extend(),Frontend.ApplicationAdapter=DS.RESTAdapter.extend({})}(),function(){Frontend.Counter=DS.Model.extend({passed:DS.attr(),wrote:DS.attr(),pass_rate:DS.attr(),title:DS.attr()})}(),function(){Frontend.Country=DS.Model.extend({name:DS.attr(),passed:DS.attr(),wrote:DS.attr(),country_name:DS.attr(),country_passed:DS.attr(),country_wrote:DS.attr(),pass_rate:function(){return this.get("passed")/this.get("wrote")*100}.property("pass_rate","passed","wrote"),setCounter:function(){var a=window.Frontend.__container__.lookup("controller:counter");a.set("title",this.get("name")),a.set("passed",this.get("passed")),a.set("wrote",this.get("wrote")),a.set("pass_rate",this.get("pass_rate"))}})}(),function(){Frontend.Province=DS.Model.extend({name:DS.attr(),code:DS.attr(),passed:DS.attr(),wrote:DS.attr(),geo_json:DS.attr(),geoJSONStyle:function(){return{fillColor:this.get("fillColor"),color:"#CCC",weight:1,opacity:1,fillOpacity:.4}}.property("getGeoJSONStyle"),fillColor:function(){var a=this.get("pass_rate");return a>80?"#47A103":a>60?"#E8DA04":a>40?"#FFB707":a>20?"#E86605":"#FF2B12"}.property("fillColor"),schoolFillColor:function(a){var b=a;return b>80?"#47A103":b>60?"#E8DA04":b>40?"#FFB707":b>20?"#E86605":"#FF2B12"},pass_rate:function(){return this.get("passed")/this.get("wrote")*100}.property("pass_rate","passed","wrote"),index:function(){return this.get("id")-1}.property("index"),dataFromJSON:function(){var a=this,b=Frontend.globalPaths.features.find(function(b){return b.properties.CAPTION===a.get("name")?!0:!1});return b}.property("dataFromJSON"),setCounter:function(){var a=window.Frontend.__container__.lookup("controller:counter");a.set("title",this.get("name")),a.set("passed",this.get("passed")),a.set("wrote",this.get("wrote")),a.set("pass_rate",this.get("pass_rate"))},resetCounter:function(){this.get("store").find("country",1).then(function(a){a.setCounter()})},zoomIn:function(){var a=this.get("geo_json").getBounds().getCenter();Frontend.map.setView(a,8),this.showSchools()},showSchools:function(){var a=this,b="/province/"+this.get("code")+"/schools";Ember.$.getJSON(b).then(function(b){Ember.$.each(b,function(b,c){var d=window.L.circleMarker([c.lat,c.lng],{color:a.schoolFillColor(c.pass_rate),opacity:.1,weight:3,fillOpacity:.5});d.addTo(Frontend.map);var e="<h3>"+c.name+"</h3>";e+="<ul class='popup-content'>",e+="<li><strong>Pass Rate: </strong>"+c.pass_rate+"%</li>",e+="<li><strong>Students passed: </strong>"+c.passed+"</li>",e+="<li><strong>Students wrote: </strong>"+c.wrote+"</li>",e+="</ul>",d.bindPopup(e),d.bringToFront()})})},onEachFeature:function(a,b){var c=this.province;b.on("mouseover",function(){c.setCounter(),b.setStyle({color:"#333",weight:1,dashArray:""})}),b.on("click",function(){b.setStyle({opacity:1,fillOpacity:0}),c.zoomIn()})}})}(),function(){Frontend.School=DS.Model.extend({name:DS.attr(),pass_rate:DS.attr(),passed:DS.attr(),wrote:DS.attr(),lng:DS.attr(),lat:DS.attr(),province_code:DS.attr(),fillColor:function(){var a=this.get("pass_rate");return a>80?"#47A103":a>60?"#E8DA04":a>40?"#FFB707":a>20?"#E86605":"#FF2B12"}.property("fillColor")})}(),function(){Frontend.AdminRoute=Ember.Route.extend({model:function(){return this.store.findAll("school")}})}(),function(){Frontend.CounterRoute=Ember.Route.extend({model:function(){var a=this.get("store").createRecord("counter");return a}})}(),function(){Frontend.IndexRoute=Ember.Route.extend({setupController:function(){}})}(),function(){Frontend.ProvincesRoute=Ember.Route.extend({model:function(){}})}(),function(){Frontend.MapView=Ember.View.extend({id:"map_canvas",tagName:"div",didInsertElement:function(){Frontend.map=window.L.map("map",{zoomControl:!1}).setView([-30.559482,22.937505999999985],6),window.L.control.zoom({position:"topright"}).addTo(Frontend.map),window.L.tileLayer("http://{s}.tile.cloudmade.com/{key}/{styleId}/256/{z}/{x}/{y}.png",{attribution:"Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade",key:"BC9A493B41014CAABB98F0471D759707",styleId:22677}).addTo(Frontend.map),window.L.control.pan({position:"topright"}).addTo(Frontend.map)}})}(),function(){Frontend.NavBarView=Ember.View.extend({tagName:"div",classNames:[]})}(),function(){Frontend.Router.map(function(){this.route("provinces"),this.route("counter"),this.resource("admin")})}(),function(){window.odometerOptions={auto:!1,format:"(,ddd).dd",duration:300,animation:"count"}}();