!function(){window.Frontend=Ember.Application.create()}(),function(){Frontend.AdminController=Ember.ArrayController.extend({schoolNameSearch:"",schoolFound:"",performedSchoolSearch:!1,actions:{filterByName:function(){var a=this.get("schoolNameSearch").toUpperCase();this.set("performedSchoolSearch",!0);var b="schools/"+a,c=this;Ember.$.getJSON(b).then(function(a){0!==a.length?c.set("schoolFound",a.school):c.set("schoolFound",null)})}}})}(),function(){Frontend.CounterController=Ember.ObjectController.extend({actions:{startOdometer:function(){"display_matric_results"===window.data_type?this.createMatricResultsOdometer():this.createSanitationInfoOdometer()}},odometerPassedValueChanged:function(){window.$(".students-passed").html(this.get("passed")),window.$(".students-wrote").html(this.get("wrote")),window.$(".students-pass-rate").html(this.get("pass_rate")),window.$(".title").html(this.get("title")),window.$(".country").html(this.get("country")),window.$(".number-of-boys").html(this.get("no_of_boys")),window.$(".number-of-girls").html(this.get("no_of_girls")),window.$(".total-toilets").html(this.get("total_toilets")),window.$(".sanitation-plan").html(this.get("sanitation_plan")),window.$(".construction").html(this.get("construction")),window.$(".running-water-percentage").html(this.get("running_water")),window.$(".matric-year").html(this.get("matric_year")),window.$(".sanitation-year").html(this.get("sanitation_year"))}.observes("passed","wrote","pass_rate","title","no_of_boys","number_of_girls","total_toilets","sanitation_plan","construction","running_water","country","sanitation_year","matric_year"),odometerFor:function(a,b){Ember.run(this,function(){new window.Odometer({el:a,value:0}),a.innerHTML=b})},createMatricResultsOdometer:function(){var a=document.querySelector(".students-pass-rate");this.odometerFor(a,this.get("pass_rate")),this.descriptionFor("students-pass-rate"),a=document.querySelector(".students-passed"),this.odometerFor(a,this.get("passed")),this.descriptionFor("students-passed"),a=document.querySelector(".students-wrote"),this.odometerFor(a,this.get("wrote")),this.descriptionFor("students-wrote")},createSanitationInfoOdometer:function(){var a=document.querySelector(".number-of-boys");this.odometerFor(a,this.get("no_of_boys")),this.descriptionFor("number-of-boys");var a=document.querySelector(".number-of-girls");this.odometerFor(a,this.get("no_of_girls")),this.descriptionFor("number-of-girls");var a=document.querySelector(".total-toilets");this.odometerFor(a,this.get("total_toilets")),this.descriptionFor("total-toilets");var a=document.querySelector(".running-water-percentage");this.odometerFor(a,this.get("running_water")),this.descriptionFor("running-water-percentage")},descriptionFor:function(a){var b=document.createElement("span");b.className="description";var c=document.getElementById(a),d=a.split("-").join(" "),e=document.createTextNode(d);b.appendChild(e),c.appendChild(b)}})}(),function(){Frontend.CountryController=Ember.ObjectController.extend({needs:["counter"],counter:Ember.computed.alias("controllers.counter"),showCountry:function(){var a=this;this.store.find("country",1).then(function(b){var c=window.data_type,d=a.get("counter");d.set("model",a.store.createRecord("counter")),"display_matric_results"===c?(d.set("passed",b.get("passed")),d.set("wrote",b.get("wrote")),d.set("pass_rate",b.get("pass_rate")),d.set("matric_year","Matric Results 2013")):(d.set("no_of_boys",b.get("no_of_boys")),d.set("no_of_girls",b.get("no_of_girls")),d.set("total_toilets",b.get("total_toilets")),d.set("running_water",b.get("running_water")),d.set("sanitation_year","Sanitation Information")),d.set("country",b.get("name")),d.send("startOdometer")})}.property("showCountry")})}(),function(){Frontend.HealthController=Ember.ObjectController.extend({})}(),function(){Frontend.IndexController=Ember.ObjectController.extend({})}(),function(){Frontend.LegendController=Ember.ObjectController.extend({actions:{makeLegend:function(){this.populateLegendQuintiles()}},populateLegendQuintiles:function(){var a=document.createElement("td");a.className="pass-rate-range-5";var b=Math.round(this.get("fourth_quintile"))+"% - "+Math.round(this.get("ceiling"))+"%",c=document.createTextNode(b);a.appendChild(c);var d=document.getElementById("pass-rate-range-5");d.appendChild(a);var e=document.createElement("td");e.className="pass-rate-range-4";var f=Math.round(this.get("third_quintile"))+"% - "+Math.round(this.get("fourth_quintile"))+"%",g=document.createTextNode(f);e.appendChild(g);var d=document.getElementById("pass-rate-range-4");d.appendChild(e);var h=document.createElement("td");h.className="pass-rate-range-3";var i=Math.round(this.get("second_quintile"))+"% - "+Math.round(this.get("third_quintile"))+"%",j=document.createTextNode(i);h.appendChild(j);var d=document.getElementById("pass-rate-range-3");d.appendChild(h);var k=document.createElement("td");k.className="pass-rate-range-2";var l=Math.round(this.get("first_quintile"))+"% - "+Math.round(this.get("second_quintile"))+"%",m=document.createTextNode(l);k.appendChild(m);var d=document.getElementById("pass-rate-range-2");d.appendChild(k);var n=document.createElement("td");n.className="pass-rate-range-1";var o=Math.round(this.get("floor"))+"% - "+Math.round(this.get("first_quintile"))+"%",p=document.createTextNode(o);n.appendChild(p);var d=document.getElementById("pass-rate-range-1");d.appendChild(n)}})}(),function(){Frontend.NavbarController=Ember.ObjectController.extend({})}(),function(){Frontend.ProvinceController=Ember.ObjectController.extend({needs:["counter","legend"],counter:Ember.computed.alias("controllers.counter"),legend:Ember.computed.alias("controllers.legend"),drawAll:function(){var a=this;Ember.$.ajax("/data/sa_provinces.json").then(function(b){Frontend.globalPaths=b,a.get("store").findAll("province").then(function(b){var c=a.calculatePassRateRanges(b);a.setLegendPassRateRanges(c),b.forEach(function(a){a.set("pass_rate_ranges",c);var b=window.L.geoJson(a.get("dataFromJSON"),{style:a.get("geoJSONStyle"),province:a,onEachFeature:a.get("onEachFeature")});a.set("geo_json",b),b.addTo(Frontend.map),window.province=a})})})}.property("drawAll"),calculatePassRateRanges:function(a){var b=[];a.forEach(function(a){b.push(a.get("pass_rate"))});for(var c=Math.max.apply(null,b),d=Math.min.apply(null,b),e=(c-d)/5,f=[],g=0;5>=g;g++)f.push(d+g*e);return f},setLegendPassRateRanges:function(a){var b=this.get("legend");b.set("model",this.store.createRecord("legend")),b.set("floor",a[0]),b.set("first_quintile",a[1]),b.set("second_quintile",a[2]),b.set("third_quintile",a[3]),b.set("fourth_quintile",a[4]),b.set("ceiling",a[5]),b.send("makeLegend")}})}(),function(){Frontend.SanitationController=Ember.ObjectController.extend({needs:["counter","province"],counter:Ember.computed.alias("controllers.counter"),province_controller:Ember.computed.alias("controllers.province"),drawAll:function(){var a=this;Ember.$.ajax("/data/sa_provinces.json").then(function(b){Frontend.globalPaths=b,a.get("store").findAll("province").then(function(b){var c=a.get("province_controller").calculatePassRateRanges(b);b.forEach(function(a){a.set("pass_rate_ranges",c);var b=window.L.geoJson(a.get("dataFromJSON"),{style:a.get("geoJSONStyle"),province:a,onEachFeature:a.get("onEachFeature")});a.set("geo_json",b),b.addTo(Frontend.map),window.province=a})})})}.property("drawAll")})}(),function(){Frontend.Store=DS.Store.extend(),Frontend.ApplicationAdapter=DS.RESTAdapter.extend({})}(),function(){Frontend.Counter=DS.Model.extend({passed:DS.attr(),wrote:DS.attr(),pass_rate:DS.attr(),title:DS.attr()})}(),function(){Frontend.Country=DS.Model.extend({name:DS.attr(),passed:DS.attr(),wrote:DS.attr(),no_of_boys:DS.attr(),no_of_girls:DS.attr(),total_toilets:DS.attr(),sanitation_plan:DS.attr(),construction:DS.attr(),running_water:DS.attr(),matric_year:DS.attr(),sanitation_year:DS.attr(),pass_rate:function(){return this.get("passed")/this.get("wrote")*100}.property("pass_rate","passed","wrote"),setCounter:function(){var a=window.Frontend.__container__.lookup("controller:counter");a.set("title",this.get("name")),a.set("passed",this.get("passed")),a.set("wrote",this.get("wrote")),a.set("pass_rate",this.get("pass_rate"))}})}(),function(){Frontend.Legend=DS.Model.extend({floor:DS.attr(),first_quintile:DS.attr(),second_quintile:DS.attr(),third_quintile:DS.attr(),fourth_quintile:DS.attr(),ceiling:DS.attr()})}(),function(){Frontend.Province=DS.Model.extend({name:DS.attr(),code:DS.attr(),passed:DS.attr(),wrote:DS.attr(),no_of_boys:DS.attr(),no_of_girls:DS.attr(),total_toilets:DS.attr(),sanitation_plan:DS.attr(),construction:DS.attr(),running_water:DS.attr(),matric_year:DS.attr(),sanitation_year:DS.attr(),geo_json:DS.attr(),minPassRate:DS.attr(),maxPassRate:DS.attr(),pass_rate_ranges:DS.attr(),geoJSONStyle:function(){return{fillColor:this.get("fillColor"),color:"#CCC",weight:1,opacity:1,fillOpacity:.4}}.property("getGeoJSONStyle"),fillColourForMatricResults:function(a){var b=a,c=this.get("pass_rate_ranges");return b>c[4]?"#47A103":b>c[3]?"#E8DA04":b>c[2]?"#FFB707":b>c[1]?"#E86605":"#FF2B12"},fillColourForSanitationInformation:function(a){return a>40?"#47A103":a>30?"#E8DA04":a>20?"#FFB707":a>10?"#E86605":"#FF2B12"},fillColor:function(){if("display_matric_results"===window.data_type)return this.fillColourForMatricResults(this.get("pass_rate"));if("display_sanitation"===window.data_type){var a=(this.get("no_of_boys")+this.get("no_of_girls"))/this.get("total_toilets");return this.fillColourForSanitationInformation(a)}}.property("fillColor"),schoolFillColor:function(a){return"display_matric_results"===window.data_type?this.fillColourForMatricResults(a.pass_rate):"display_sanitation"===window.data_type?(console.log("Setting school colours for sanitation information"),"unknown"!=a.no_of_boys?this.fillColourForSanitationInformation((a.no_of_boys+a.no_of_girls)/a.total_toilets):"#57A7C7"):void 0},pass_rate:function(){return this.get("passed")/this.get("wrote")*100}.property("pass_rate","passed","wrote"),index:function(){return this.get("id")-1}.property("index"),dataFromJSON:function(){var a=this,b=Frontend.globalPaths.features.find(function(b){return b.properties.CAPTION===a.get("name")?!0:!1});return b}.property("dataFromJSON"),setCounter:function(){var a=window.Frontend.__container__.lookup("controller:counter"),b=window.data_type;a.set("title",this.get("name")),"display_matric_results"===b?(a.set("passed",this.get("passed")),a.set("wrote",this.get("wrote")),a.set("pass_rate",this.get("pass_rate"))):(a.set("no_of_boys",this.get("no_of_boys")),a.set("no_of_girls",this.get("no_of_girls")),a.set("total_toilets",this.get("total_toilets")),a.set("sanitation_plan",this.get("sanitation_plan")),a.set("construction",this.get("construction")),a.set("running_water",this.get("running_water")))},zoomIn:function(){var a=this.get("geo_json").getBounds().getCenter();Frontend.map.setView(a,8),this.showSchools()},popupForMatricResult:function(a){var b="<h3>"+a.name+"</h3>";return b+="<ul class='popup-content'>",b+="<li><strong>Pass Rate: </strong>"+a.pass_rate+"</li>",b+="<li><strong>Students passed: </strong>"+a.passed+"</li>",b+="<li><strong>Students wrote: </strong>"+a.wrote+"</li>",b+="</ul>"},popupForSanitationInformation:function(a){var b="<h3>"+a.name+"</h3>";return b+="<ul class='popup-content'>",b+="<li><strong>Number of boys: </strong>"+a.no_of_boys+"</li>",b+="<li><strong>Number of girls: </strong>"+a.no_of_girls+"</li>",b+="<li><strong>Total toilets: </strong>"+a.total_toilets+"</li>",b+="<li><strong>DOE Sanitation plan: </strong>"+a.sanitation_plan+"</li>",b+="<li><strong>Running water: </strong>"+a.running_water+"</li>",b+="<li><strong>Construction Status: </strong>"+a.construction+"</li>",b+="</ul>"},showSchools:function(){var a=this,b="/province/"+this.get("code")+"/schools";Ember.$.getJSON(b).then(function(b){Ember.$.each(b,function(b,c){console.log(c.no_of_boys);var d=window.L.circleMarker([c.lat,c.lng],{color:a.schoolFillColor(c),opacity:.1,weight:3,fillOpacity:.5});if("display_matric_results"===window.data_type){var e=a.popupForMatricResult(c);d.bindPopup(e)}else{var e=a.popupForSanitationInformation(c);d.bindPopup(e)}d.addTo(Frontend.map),d.bringToFront()})})},onEachFeature:function(a,b){var c=this.province;b.on("mouseover",function(){c.setCounter(),b.setStyle({color:"#333",weight:1,dashArray:""})}),b.on("click",function(){b.setStyle({opacity:1,fillOpacity:0}),c.zoomIn()})}})}(),function(){Frontend.Sanitation=DS.Model.extend({name:DS.attr(),lat:DS.attr(),lng:DS.attr(),no_of_boys:DS.attr(),no_of_girls:DS.attr(),total_toilets:DS.attr(),sanitation_plan:DS.attr(),construction:DS.attr(),running_water:DS.attr()})}(),function(){Frontend.School=DS.Model.extend({name:DS.attr(),pass_rate:DS.attr(),passed:DS.attr(),wrote:DS.attr(),lng:DS.attr(),lat:DS.attr(),province_code:DS.attr(),fillColor:function(){var a=this.get("pass_rate");return a>80?"#47A103":a>60?"#E8DA04":a>40?"#FFB707":a>20?"#E86605":"#FF2B12"}.property("fillColor")})}(),function(){Frontend.AdminRoute=Ember.Route.extend({model:function(){}})}(),function(){Frontend.ApplicationRoute=Em.Route.extend({setupController:function(a,b){this._super(a,b),this.get("store").findAll("school"),this.get("store").findAll("sanitation")}})}(),function(){Frontend.CounterRoute=Ember.Route.extend({model:function(){var a=this.get("store").createRecord("counter");return a}})}(),function(){Frontend.HealthRoute=Ember.Route.extend({model:function(){return this.get("store").all("sanitation")},enter:function(){window.data_type="display_sanitation"}})}(),function(){Frontend.IndexRoute=Ember.Route.extend({setupController:function(){return this.get("store").all("school")},enter:function(){window.data_type="display_matric_results"}})}(),function(){Frontend.LegendRoute=Ember.Route.extend({model:function(){var a=this.get("store").createRecord("legend");return a}})}(),function(){Frontend.ProvinceRoute=Ember.Route.extend({model:function(){}})}(),function(){Frontend.MapView=Ember.View.extend({id:"map_canvas",tagName:"div",didInsertElement:function(){Frontend.map=window.L.map("map",{zoomControl:!1}).setView([-29.328516,23.751131],6),window.L.control.zoom({position:"topright"}).addTo(Frontend.map),window.L.tileLayer("http://{s}.tile.cloudmade.com/{key}/{styleId}/256/{z}/{x}/{y}.png",{attribution:"Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade",key:"BC9A493B41014CAABB98F0471D759707",styleId:22677}).addTo(Frontend.map),window.L.control.pan({position:"topright"}).addTo(Frontend.map)}})}(),function(){Frontend.NavBarView=Ember.View.extend({tagName:"div",classNames:[]})}(),function(){Frontend.Router.map(function(){this.route("provinces"),this.route("counter"),this.route("legend"),this.resource("admin"),this.resource("sanitation"),this.resource("health")})}(),function(){window.odometerOptions={auto:!1,format:"(,ddd).dd",duration:300,animation:"count"}}();